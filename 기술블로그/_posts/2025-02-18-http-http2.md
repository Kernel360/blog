---
layout: post
title: "HTTP/1.1 ê³¼ HTTP/2"
author: "ìœ¤ì„ëª¨"
categories: "ê¸°ìˆ ë¸”ë¡œê·¸"
banner:
  image: "assets/images/post/2023-11-05.webp"
  background: "#000"
  height: "100vh"
  min_height: "38vh"
  heading_style: "font-size: 4.25em; font-weight: bold; text-decoration: underline"
  tags: ["http", "http2", "FCM"]
---


### 1ï¸âƒ£ ê°œìš”

í”„ë¡œì íŠ¸ì—ì„œ ì•Œë¦¼ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ Firebase Cloud Messaging(FCM) Firebase Admin Java SDK 9.4.3 ë²„ì „ì„ ì‚¬ìš©í•˜ë˜ ì¤‘, HTTP/2 ê´€ë ¨ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.
org.apache.hc.core5.http.ProtocolException: Header 'Host: fcm.googleapis.com' is illegal for HTTP/2 messages
ì´ ì˜¤ë¥˜ëŠ” ì±„íŒ… ë©”ì‹œì§€ì— ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ì„œ ë°œìƒí•˜ì˜€ë‹¤. ì‚¬ìš©ìê°€ ì±„íŒ…ì„ ì—°ì†ìœ¼ë¡œ ë³´ë‚¼ ë•Œ, ê° ë©”ì‹œì§€ë§ˆë‹¤ FCMì„ í†µí•´ ì•Œë¦¼ì´ ì „ì†¡ë˜ë„ë¡ êµ¬í˜„í–ˆëŠ”ë°, 
ë‹¨ê¸°ê°„ì— ë§ì€ ì•Œë¦¼ ìš”ì²­ì´ ë°œìƒí•˜ë©´ì„œ ìœ„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì´ìœ ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ HTTP/1.1ê³¼ HTTP/2ì˜ ì°¨ì´ì ì— ëŒ€í•´ ì •ë¦¬í–ˆë‹¤.

### 2ï¸âƒ£ HTTP ë€?
   HTTP(HyperText Transfer Protocol, í•˜ì´í¼í…ìŠ¤íŠ¸ ì „ì†¡ í”„ë¡œí† ì½œ)ëŠ” **ì›¹ì—ì„œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê·œì¹™(í”„ë¡œí† ì½œ)**ì…ë‹ˆë‹¤. 
  ìš°ë¦¬ê°€ ì¸í„°ë„·ì—ì„œ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•  ë•Œ, ì›¹ ë¸Œë¼ìš°ì €(ì˜ˆ: í¬ë¡¬, ì—£ì§€, ì‚¬íŒŒë¦¬ ë“±)ì™€ ì›¹ ì„œë²„ ê°„ì˜ í†µì‹ ì´ HTTPë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

#### HTTPì˜ íŠ¹ì§•
    âœ… ë¹„ì—°ê²°ì„±(Connectionless)
    ìš”ì²­ê³¼ ì‘ë‹µì´ ëë‚˜ë©´ ì—°ê²°ì´ ëŠì–´ì ¸ì„œ ì„œë²„ì˜ ë¶€ë‹´ì´ ì ìŠµë‹ˆë‹¤.

    âœ… ë¬´ìƒíƒœì„±(Stateless)
    ì´ì „ ìš”ì²­ê³¼ ë‹¤ìŒ ìš”ì²­ì´ ì„œë¡œ ë…ë¦½ì ì´ì–´ì„œ ìƒíƒœë¥¼ ìœ ì§€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

    âœ… í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡œí† ì½œ
    ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ê¸° ë•Œë¬¸ì— ë””ë²„ê¹…ì´ ì‰½ìŠµë‹ˆë‹¤.

### 3ï¸âƒ£ HTTP/1.1 vs HTTP/2 ì°¨ì´ì 

#### 3.1 HTTP/1.1 íŠ¹ì§•

HTTP/1.1ì€ 1997ë…„ì— ë„ì…ëœ í”„ë¡œí† ì½œë¡œ, í˜„ì¬ê¹Œì§€ë„ ë„ë¦¬ ì‚¬ìš©ë˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ ëª‡ ê°€ì§€ í•œê³„ì ì´ ìˆë‹¤.
ì§€ì†ì ì¸ ì—°ê²°(Persistent Connection): Keep-Aliveë¥¼ í†µí•´ ì—°ê²°ì„ ìœ ì§€í•˜ì—¬ ì„±ëŠ¥ì„ ê°œì„ í•˜ì§€ë§Œ, ì—¬ì „íˆ ìš”ì²­ì´ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë¨.
í—¤ë” í¬ê¸° ì¦ê°€ ë¬¸ì œ: ìš”ì²­ë§ˆë‹¤ í—¤ë”ê°€ í¬í•¨ë˜ë©°, ì¤‘ë³µ ë°ì´í„°ê°€ ë§ì•„ ì„±ëŠ¥ ì €í•˜ë¥¼ ìœ ë°œí•¨.

íŒŒì´í”„ë¼ì´ë‹(Pipelining) ì§€ì›í•˜ì§€ë§Œ HOLB(Head-of-Line Blocking) ë¬¸ì œ ì¡´ì¬:
ì—¬ëŸ¬ ìš”ì²­ì„ í•œ ë²ˆì— ë³´ë‚¼ ìˆ˜ ìˆì§€ë§Œ, ì‘ë‹µì´ ìˆœì°¨ì ìœ¼ë¡œ ì™€ì•¼ í•¨.
í•˜ë‚˜ì˜ ìš”ì²­ì´ ì§€ì—°ë˜ë©´ ì´í›„ ìš”ì²­ë„ ì§€ì—°ë¨.

í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡œí† ì½œ: ì‚¬ëŒì´ ì½ê¸° ì‰½ì§€ë§Œ, ë°ì´í„° ì „ì†¡ì´ ë¹„íš¨ìœ¨ì .

#### 3.2 HTTP/2 íŠ¹ì§•

HTTP/2ëŠ” 2015ë…„ì— ë„ì…ëœ í”„ë¡œí† ì½œë¡œ, HTTP/1.1ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ì—¬ ì„±ëŠ¥ì„ ëŒ€í­ í–¥ìƒì‹œì¼°ë‹¤.
ë©€í‹°í”Œë ‰ì‹±(Multiplexing) ì§€ì›: í•˜ë‚˜ì˜ TCP ì—°ê²°ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ìš”ì²­ê³¼ ì‘ë‹µì„ ë™ì‹œì— ì²˜ë¦¬ ê°€ëŠ¥ â†’ HOLB ë¬¸ì œ í•´ê²°.
ì´ì§„ í”„ë ˆì´ë°(Binary Framing) ì‚¬ìš©: í…ìŠ¤íŠ¸ ëŒ€ì‹  ì´ì§„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì†¡ íš¨ìœ¨ ì¦ê°€.
í—¤ë” ì••ì¶•(HPACK ì‚¬ìš©): ì¤‘ë³µëœ í—¤ë” ë°ì´í„°ë¥¼ ì¤„ì—¬ ì„±ëŠ¥ ê°œì„ .
ì„œë²„ í‘¸ì‹œ(Server Push) ì§€ì›: í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì—†ì´ë„ ì„œë²„ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¯¸ë¦¬ ì „ì†¡ ê°€ëŠ¥.
ìš°ì„ ìˆœìœ„ ì§€ì • ê°€ëŠ¥: ì¤‘ìš”í•œ ìš”ì²­ì„ ë¨¼ì € ì²˜ë¦¬í•˜ë„ë¡ ì¡°ì • ê°€ëŠ¥.

### 4ï¸âƒ£ HTTP/2ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ ë¶„ì„

#### 4.1 ì˜¤ë¥˜ ì›ì¸
```Header 'Host: fcm.googleapis.com' is illegal for HTTP/2 messages``` ì˜¤ë¥˜ëŠ” HTTP/2ì—ì„œ Host í—¤ë”ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë°œìƒí•œë‹¤.

- HTTP/1.1ì—ì„œëŠ” Host í—¤ë”ê°€ í•„ìˆ˜ì´ì§€ë§Œ, HTTP/2ì—ì„œëŠ” ``** Pseudo-header**ê°€ ëŒ€ì‹  ì‚¬ìš©ë¨.(:authority ë¡œ ëŒ€ì²´)

  ğŸ“Œ Pseudo-headerë€?
  HTTP/2ì—ì„œ ì‚¬ìš©ë˜ëŠ” íŠ¹ìˆ˜í•œ í˜•íƒœì˜ í—¤ë”ë¡œ, ê¸°ì¡´ HTTP/1.1ì˜ ì¼ë¶€ í—¤ë”(ì˜ˆ: Host)ë¥¼ ëŒ€ì²´í•˜ì—¬ ìš”ì²­ê³¼ ì‘ë‹µì„ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

- FCM API ìš”ì²­ ì‹œ, HTTP/1.1 ìŠ¤íƒ€ì¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ì„œ Host í—¤ë”ê°€ í¬í•¨ë˜ë©´ HTTP/2ì—ì„œ ì˜¤ë¥˜ ë°œìƒ.
 â˜… Firebase Admin Java SDK 9.4.0 ë²„ì „ë¶€í„° HTTP/2 ì§€ì› ì „ì†¡ì´ ì¶”ê°€ ë˜ì–´ ê¸°ë³¸ HTTP ì „ì†¡ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

#### 4.2. ì˜¤ë¥˜ í•´ê²° ë°©ë²•
 FCM ìš”ì²­ HTTP/2 -> HTTP/1.1ë¡œ ê°•ì œí•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.
 ```
    // HTTP/1.1ì„ ì‚¬ìš©í•˜ë„ë¡ NetHttpTransport ì ìš©
		HttpTransport httpTransport = new ApacheHttpTransport();
		
	// Firebase ì˜µì…˜ ì„¤ì •
		FirebaseOptions options = FirebaseOptions.builder()
			.setCredentials(GoogleCredentials.fromStream(serviceAccount))
		 	.setHttpTransport(httpTransport)
			.build();
  ```
